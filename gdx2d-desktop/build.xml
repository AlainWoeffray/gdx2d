<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!--
	ANT Build script for the gdx2d-desktop project.
	
	The project is compiled in the "bin" folder and
	the runnable jar file is available in the "dist" folder.
	
	@author Christopher MÃ©trailler (mei@hevs.ch)
	@version 1.0
-->
<project default="export-all" name="gdx2d-desktop" basedir=".">
    
    <description>
		ANT build script for the gdx2d-desktop project.
    </description>

    <!-- Build properties -->
    <property file="build.properties" />
    
	<property name="src" location="src"/>
	<property name="build" location="bin"/>
	<property name="dist"  location="dist"/>
	<property name="data" location="data"/>
    <property name="libs" location="libs"/>
    <property name="main-class" value="hevs.gdx2d.demos.DemoSelector"/>
    <property name="jar-filename" value="${project-name}-${project-version}"/>
        
    
	<tstamp>
		<format property="today" pattern="yyyy-MM-dd HH:mm:ss" />
	</tstamp>
	
	<path id="project-classpath">
	    <!-- Include all external jar -->
		<fileset dir="libs" includes="*.jar" />
	</path>
	
    <target name="init" description="init build folder">
        <echo>Build script for the "${project-name}" project, version ${project-version}.</echo>
    	<tstamp/>
    	<mkdir dir="${build}"/>
    	<mkdir dir="${dist}"/>
  	</target>
    
    <target name="clean" description="clean all">
        <delete dir="${build}"/>
        <delete dir="${dist}"/>
    </target>
    
    <target name="compile-all" depends="clean, init" description="compile Java source" >
    	<!-- Compile gdx2d Java source files -->
    	<javac srcdir="${src}" destdir="${build}" classpathref="project-classpath" includeantruntime="false">
    	    <!-- Exclude doc files -->
    	    <exclude name="**/package-info.java"/>
    	</javac>
	</target>
    
    <target name="export-all" depends="compile-all">
        <jar destfile="${dist}/${jar-filename}.jar" basedir="${build}">
            
            <!-- Includes all class and libraries into the jar -->
            <fileset dir="${data}"/>
            <fileset dir="${libs}"/>
            
            <zipfileset excludes="META-INF/*.SF" src="${libs}/gdx-backend-lwjgl-natives.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="${libs}/gdx-backend-lwjgl.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="${libs}/gdx-natives.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="${libs}/tween-engine-api.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="${libs}/gdx.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="${libs}/box2dlights.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="${libs}/gdx-freetype-natives.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="${libs}/gdx-freetype.jar"/>

            <manifest>
                <!-- Demo selector launcher -->
                <attribute name="Main-Class" value="${main-class}"/>
                
                <attribute name="Implementation-Vendor" value="isi-hevs"/>
				<attribute name="Implementation-Title" value="${project-name}"/>
				<attribute name="Implementation-Version" value="${project-version}"/>
				
				<attribute name="Built-By" value="mei@hevs.ch"/>
				<attribute name="Built-Date" value="${today}"/>
            </manifest>
        </jar>
    </target>
    
    <!-- TODO: export javadoc (mei) -->
    
    <!-- TODO: export gdx2d library only, without demos (mei) -->
    
    <target name="run-demo">
        <!-- Run demos if the jar is already exported -->
        <java jar="${dist}/${jar-filename}.jar" fork="true"/>
    </target>
    
</project>
